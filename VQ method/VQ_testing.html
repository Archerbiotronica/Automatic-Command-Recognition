<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Jupyter Notebooks(ipynb) Viewer and Converter</title>
<meta name="description" content="This online app allows you to convert Jupyter Notebooks (ipynb) to HTML, PDF format. It is easy to use, With just a few clicks, you can get the converted HTML or PDF, and View this file from your browser directly.">
<meta name="keywords" content="ipynb viewer, online ipynb viewer, ipynb to pdf, ipynb to html, convert ipynb to pdf, ipynb print, ipynb reader">

<meta property="og:title" content="Jupyter Notebooks(ipynb) Viewer and Converter"> 
<meta property="og:description" content="This online app allows you to convert Jupyter Notebooks (ipynb) to HTML, PDF format. It is easy to use, With just a few clicks, you can get the converted HTML or PDF, and View this file from your browser directly.">
<meta property="og:type" content="website">
<meta property="og:url" content="//htmtopdf.herokuapp.com/ipynbviewer/">
<meta property="og:image" content="//htmtopdf.herokuapp.com/ipynbviewer/img/logo128.png">

<link rel="shortcut icon" href="favicon.ico">
<style>
*{
	font-size:14px;
	font-family: Verdana, Arial, Helvetica, sans-serif;
}
body{background:#E9EAED;}
A:link    {color:#0860A8;text-decoration:none;}
A:visited {color:#0860A8;text-decoration:none;}
A:active  {color:#0860A8;text-decoration:underline;}
A:hover  {color;#0860A8;text-decoration:underline;}

.divopt{
	-webkit-box-shadow: 0 0 10px #999;
	-moz-box-shadow: 0 0 10px #999;
	box-shadow: 0 0 10px #999;
}
.uploaded{color:green;}
.error{color:#8A0808;}
.welcome{color:#45616D;}

#downlink3 {font-size:22px;color:green}
#downlink3 a{font-size:22px}
.hover { border: 5px dashed #333; }
</style>

<script src="js/common.js" type="text/javascript"></script>
<script>
var gadb=false;
window.URL=(window.URL || window.webkitURL);
var ischrome=false;
var isgecko=false;
var isopera=false;
//var ismsie=false;
if (navigator.appName=="Netscape"){
	if (navigator.userAgent.indexOf("Chrome")>=0) ischrome=true;
	if (navigator.userAgent.indexOf("Gecko")>=0) isgecko=true;
} else {
	if (navigator.userAgent.indexOf("Opera")>=0) isopera=true;
	//if (navigator.userAgent.indexOf("MSIE")>=0) ismsie=true;
}
var isedge=false;
if (navigator.userAgent.indexOf("Edge")>=0){ischrome=false;isedge=true;}

function proc_saveopt(){
	var b=[];
	var c;
	var obj=_getid("optcontainer");
	var a=obj.getElementsByTagName('INPUT');
	for(var i = 0; i < a.length; i++){    
		if(a[i].type=='checkbox'){
			c={};
			c.name=a[i].name;
			c.type=a[i].type;
			c.checked=a[i].checked;
			b.push(c);
		}else if(a[i].type=='text' || a[i].type=='number'){
			c={};
			c.name=a[i].name;
			c.type=a[i].type;
			c.value=a[i].value;
			b.push(c);
		}
	}
	function find(name1,name2){
		var a=obj.getElementsByTagName(name1);
		var s;
		for(var i = 0; i < a.length; i++){    
			if(a[i].form && a[i].form.name){
				s=a[i].value || '';
				if(s.length>256*1024)continue;
				c={};
				c.name=a[i].name;
				c.type=name2;
				c.value=s;
				b.push(c);
			}
		}
	}
	find('SELECT','select');
	find('TEXTAREA','textarea');

	if(window.JSON) setstorage('ipyv_c_opt',JSON.stringify(b));
}
function proc_loadopt(){
	var s=getstorage('ipyv_c_opt');
	var b=[];
	try{
		b=JSON.parse(s);
	}catch(err){
		b=[];
	}
	if(!b) b=[];

	var c;
	for(var i = 0; i < b.length; i++){    
		if(b[i].type=='checkbox'){
			c=document.optcontainer[b[i].name];
			if(c) c.checked=b[i].checked;
		}else if(b[i].type=='select' || b[i].type=='text' || b[i].type=='textarea' || b[i].type=='number'){
			c=document.optcontainer[b[i].name];
			if(c) c.value=b[i].value;
		}
	}
	var a=_getid("optcontainer").getElementsByTagName('*');
	for(var i = 0; i < a.length; i++){    
		if(a[i].tagName=='SELECT'){
			a[i].onchange=proc_saveopt;
			if(a[i].name=='o_results'){
				a[i].onchange=function(){
					o_results_onchange();
					proc_saveopt();
				}
			}
		}else if(a[i].type=='checkbox'){
			a[i].onclick=proc_saveopt;
		}
	}
}

function init(){
	window.onunload=function(){
		proc_saveopt();
	}	
}
</script>
</head>
<body onload="init()">

<script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="kr19li1hb5w4btr"></script>
<script type="text/javascript" src="https://app.box.com/js/static/select.js"></script>

<table align=center>
<tr><td height=4>
<tr><td>
	<center>
	<a id="toptitle" href="/ipynbviewer/" title="Go Home" style="color:#aa2222"><span id='i18n' style="font-size:28px;font-family:Verdana, Arial;font-weight:bold">Jupyter Notebooks(ipynb) Viewer and Converter</span></a>
	</center>
<tr><td height=10>
</table>

<table id="maintable" align=center width=810 class="divopt" style="background: white;padding:5px 10px;border: 0px solid #2E79DB;">
<tr><td align=center>
<script type="text/javascript">
    google_ad_client = "ca-pub-1113541014872557";
    google_ad_slot = "7738034505";
    google_ad_width = 728;
    google_ad_height = 90;
</script>
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js" onerror="gadb=true;">
</script>

<tr><td align=center>

<style>
.speed{
	font-size:32px;
	color:green;
}
.big1{	font-size:17px;}
.sel1{font-size:17px;margin-bottom:4px;}
.sel1 label{font-size:17px;}
.number1{width:70px;}
</style>

<table width=740>
<tr><td><img src="img/logo128.png" width=110><td>
<td align=left>
This online app allows you to convert Jupyter Notebooks (ipynb) to HTML, PDF format.
It is easy to use, With just a few clicks, you can get the converted HTML or PDF, and View this file from your browser directly.<br>
An IPYNB file is a notebook document used by Jupyter Notebook, an interactive computational environment designed to help scientists work with the Python language and their data.<br>
You can open a ipynb file from local computer, Web URL, Google Drive, Dropbox, and Box.
Max IPYNB size 7 MB. Free OO converts/1 Day.
</table>

<tr><td align=center>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-1113541014872557"
     data-ad-slot="7738034505"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div style="margin-top:8px;margin-bottom:4px">
	<div class="sel1"><label id="sel1"><input type="radio" name="selenc" id="selenc" checked=true onclick="attachment_onchange()"> Select from a IPYNB file</label></div>
<div id="divopen">
<table><tr>
<td><div id="dfile1" style="display:"></div>
<td>Drop files on this page.
</table>
<script>document.getElementById("dfile1").innerHTML='<input type="file" id="fileload1" name="files[]" multiple style="width:22	0px;margin-left:2px">';</script>
</div>

<button type="button" id='btn_open' onclick="gd_open_picker()" title="Select files to convert from Google Drive" class=big1><img src="images/gdrive/product16.png" width=18 align="absmiddle"> Select files from Google Drive</button>
<button type="button" onclick="open_dropbox()" class=big1><img src="images/service/dropbox.png" align="absmiddle" width=18> Select from Dropbox</button>
<button type="button" onclick="open_box()" class=big1><img src="images/service/box.png" align="absmiddle" width=18> Select from Box</button>

<table id="attachments" style="display:none"><tr><td align=left>
<select id='attachment' style="width:650px;height:100px" multiple=true onchange="attachment_onchange()" onclick="attachment_onchange()"></select>
<div id="desc" style="margin-top:2px;color:green;width:600px;white-space:nowrap;overflow:hidden;border:0px solid red"></div>
</table>
</div>

<tr><td>
<tr><td align=center>
	<div class="sel1"><label id="sel2"><input type="radio" name="selenc" id="selenc2"> Select from Web IPYNB URL</label> &nbsp;<a href="#" onclick="proc_sample();return false" style="font-size:13px">Sample</a></div>

	<form id="optcontainer" name="optcontainer" onsubmit="return false" style="display:inline">
<table>
<tr><td align=center>Web IPYNB URL <input type=text name="weburl" style="width:620px;font-size:16px;" spellcheck=false autocomplete="off" value="" onfocus="_getid('selenc2').checked=true;">	
<tr><td>
<tr><td align=center>
Results Format <select name="o_results" onchange="o_results_onchange()" style="font-size:15px">
<option value="html">HTML Only (Print in a browser)
<option value="html,pdf">HTML + PDF
</select>

<tr><td>
<div id="o_results1" style="display:none;border:1px dashed #0860A8;padding:4px;margin-top:2px;">
<table>
<tr><td colspan=2>PDF Page Size <select name="o_pagesize">
<script>
var SIZES = {
    A0: [2383.94, 3370.39], A1: [1683.78, 2383.94], A2: [1190.55, 1683.78], A3: [841.89, 1190.55], A4: [595.28, 841.89], A5: [419.53, 595.28], A6: [297.64, 419.53], A7: [209.76, 297.64],
    A8: [147.40, 209.76],  A9: [104.88, 147.40], B0: [2834.65, 4008.19], B1: [2004.09, 2834.65], B2: [1417.32, 2004.09],  B3: [1000.63, 1417.32], B4: [708.66, 1000.63], B5: [498.90, 708.66],
    B6: [354.33, 498.90], B7: [249.45, 354.33], B8: [175.75, 249.45], B9: [124.72, 175.75], B10: [87.87, 124.72], Executive: [521.86, 756.00], Folio: [612.00, 936.00], Legal: [612.00, 1008.00], Letter: [612.00, 792.00], Tabloid: [792.00, 1224.00]
  };
var s1;
for (var x in SIZES){
	s1=x+' ('+SIZES[x][0]+' X '+SIZES[x][1]+')';
	if(x=='A4') document.write('<option value="'+x+'" selected>'+s1+' (Default)');
	else document.write('<option value="'+x+'">'+s1);
}
</script>
</select>
&nbsp;PDF Orientation <select name="o_orientation">
<option value="Portrait">Portrait
<option value="Landscape">Landscape
</select>
<tr><td colspan=2>PDF Margins Bottom <input type=number name="o_mbottom" class="number1" value=2 min=0 max=200>, 
Left <input type=number name="o_mleft" class="number1" value=2 min=0 max=200>, 
Right <input type=number name="o_mright" class="number1" value=2 min=0 max=200>, 
Top <input type=number name="o_mtop" class="number1" value=2 min=0 max=200> &nbsp;(Default: 2)
<tr><td colspan=2>PDF Zoom <input type=text name="o_zoom" class="number1" value="0.9"> (0.5~3x, Default:0.9)
</table>
</div>

</table>
	</form>

<tr><td align=center>
	<div id="downlink" style="margin-top:2px"></div>
	<div id="msg" style="display:;margin-top:4px;font-size:15px;color:green;width:650px;white-space:nowrap;overflow:hidden;border:0px solid red"></div>

<tr><td align=center>
	<button id="btn_upload" onclick="proc_upload()" style="font-size:20px;">View and Convert</button> 

<tr><td>
<div id="downlink2" style="margin:0px 20px 5px 20px;width:710px;white-space:nowrap;overflow:hidden;border:0px solid red"></div>

<script>
function proc_sample(){
	document.optcontainer['weburl'].value='https://htmtopdf.herokuapp.com/ipynbviewer/sample/Frontend-Kernel-Model.ipynb';
	_getid('selenc2').checked=true;
}
function o_results_onchange(){
	var o_results=document.optcontainer['o_results'].value;
	if(o_results=='html,pdf') _getid('o_results1').style.display='';
	else _getid('o_results1').style.display='none';
}

var cl_files=[];
function cl_error(s){
}
var boxOptions = {
    clientId: 'c0d4g5gw4956htyb3snng9pl7uqdz0x6',
    linkType: 'direct',
    multiselect: true
};
var boxSelect;
function init_box(){
 if(!boxSelect){
	boxSelect = new BoxSelect(boxOptions);
	boxSelect.success(function(files) {
	  if(!files || files.length==0){
		  cl_error('Error!!');
		  return;
	  }
	  var a;
	  cl_files=[];
	  for(var i = 0; i <= files.length-1; i++){
		  if(files[i].is_dir)continue;
		  a={};
		  a.service='Box.com';
		  a.filename=files[i].name;
		  a.link=files[i].url;
		  a.size=files[i].size;
		  cl_files.push(a);
	  }
	  cl_display();			
	});
	boxSelect.cancel(function() {
		//cl_error('Canceled by user.');
	});
 }
}
function open_box(){
	init_box();
	boxSelect.launchPopup();
}

var dropboxOptions = {
    success: function(files) {
	  if(!files || files.length==0){
		  cl_error('Error!!');
		  return;
	  }
	  var a;
	  cl_files=[];
	  for(var i = 0; i <= files.length-1; i++){
		  if(files[i].is_dir)continue;
		  a={};
		  a.service='Dropbox';
		  a.filename=files[i].name;
		  a.link=files[i].link || '';
		  if(a.link.indexOf('?dl=1')<0) a.link+='?dl=1';
		  a.size=files[i].bytes;
		  cl_files.push(a);
	  }
	  cl_display();
    },
    cancel: function() {
		//cl_error('Canceled by user.');
    },
    linkType: "direct", //preview,direct
    multiselect: true, 
    //extensions: ['.pdf', '.doc', '.docx'],
};
function open_dropbox(){
	if(gd_checkwork())return;
	Dropbox.choose(dropboxOptions);
}

function handleFileSelect(files){
	if(!files || files.length==0) return;		
	
	cl_files=[];
	function go(idx){
		if(idx>files.length-1){
			cl_display();
			return;
		}
		var f=files[idx];
		if(!f)return;
		var a={};
		a.service='Local File';
		a.filename=f.name;
		a.link='';
		a.size=f.size;
		a.f=f;
		cl_files.push(a);		
		go(idx+1);
	}
	go(0);
}

function cl_display(){
	var a=_getid("attachment");
	for(var i=a.options.length-1;i>=0;i--) a.remove(i);
	_getid("desc").innerHTML='';

	if(cl_files.length==0){
		//alert('No selected file');
		return;
	}

	var obj2=_getid("attachment");
	var d,s;
	for(var i = 0; i <= cl_files.length-1; i++){
		d=cl_files[i];
		var c=document.createElement("option");
		if(d.link){
			s=d.filename+getsize(d.size)+' - '+d.service;
		}else{
			if(d.f) s='';
			else s='[No Download Link] ';
			s+=d.filename+' - '+d.service;
		}
		c.value=i;
		c.appendChild(document.createTextNode(s));		 
		obj2.appendChild(c);			
	}

	if(!u_uploading && cl_files.length>0){
		obj2.selectedIndex=0;
		attachment_onchange();
	}
	_getid('attachments').style.display='';
	_getid('selenc').checked=true;
}

var gresp, u_uploading;
function getfileext(s){
	if(!s) s='';var arr=s.split('.');if(arr.length>1){return arr[arr.length-1].toLowerCase();}return '';
}
function guid(){
	return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
	    var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);
		return v.toString(16);
	});
}
function proc_upload(){
function g(issave,name){
  var data={};
  try{    
    try{
      data=JSON.parse(getstorage(name));
    }catch(err){
      data={};
    }
    if(!data) data={};
    var now=new Date();
    var time=now.getFullYear()+'-'+(now.getMonth()+1)+'-'+now.getDate();
    if(data.time!=time){
      data.time=time;
      data.count=1;
    }else{      
      if(!data.count)data.count=1;    
      data.count=data.count+1;
    }
    if(issave) setstorage(name, JSON.stringify(data));	
  }catch(err){}
  return data;
}
	if(gadb){alert('Please disable the adblock for free use.');return;}
	var maxsize=7;
	
	var form=document.optcontainer;
	var o_results=form['o_results'].value;
	var o_fontsize='';//form['o_fontsize'].value;
	var o_mbottom=form['o_mbottom'].value;
	var o_mleft=form['o_mleft'].value;
	var o_mright=form['o_mright'].value;
	var o_mtop=form['o_mtop'].value;
	var o_pagesize=form['o_pagesize'].value;
	var o_orientation=form['o_orientation'].value;
	var o_zoom=form['o_zoom'].value;

	var weburl='';
	if(_getid('selenc2').checked){
		weburl=trim(form['weburl'].value);
		if(!weburl){
			alert('Please enter a URL.');
			form['weburl'].focus();
			return;
		}
		if(!validateURL(weburl)){
			alert("It is not a valid URL.");
			form['weburl'].focus();
			return;
		}
	}
	
	if(weburl){
		if(!gresp || !gresp.weburl) gresp={'weburl':true};
	}else{
		if(!gresp){
			alert('Please select a IPYNB file.');
			return;
		}
		var uname=(gresp.filename || '').replace(/[\\\\/:?*\"|<>]/g,'-');
		if(gresp.size==0){alert('File size is zero. or File not found.');return;}
		if(gresp.size>maxsize*1024*1024){
			alert('The file size is too large to upload. ('+maxsize+' MB limit)');return;
		}
		var ext=getfileext(gresp.filename);
		if((",ipynb,").indexOf(","+ext+",")<0){
			if(gresp.resp && /\/(ipynb)/i.test(gresp.resp.mimeType || '')){
			}else{
				alert('Not supported file type ('+(ext || 'Unknown')+').');
				return;
			}
		}		
	}
	var o_opts=o_results+','+o_fontsize+','+o_mbottom+','+o_mleft+','+o_mright+','+o_mtop+','+o_pagesize+','+o_orientation+','+o_zoom+','+weburl;

	function setcontrol(){
		var a=gresp.uploaded;
		var s1='<div style="font-size:17px;color:green;margin-top:0px;">Converted.';
		if(a.destfile){
			var plink=a.destfile_enc+"?t="+(new Date()).getTime();
			s1+=' &nbsp;<a href="#" onclick="proc_gview(false,this);return false" data="'+plink+'" title="View this file\n'+henc(a.destfile_name)+'">View '+getsize(a.destfile_size)+'</a>';
			s1+=' &nbsp;<a href="'+plink+'" target="_blank" title="View this file in a new window\n'+henc(a.destfile_name)+'">New, Print</a> &nbsp;<a href="#" onclick="proc_save(\''+escape(a.destfileorg)+'\');return false" title="Save to Google Drive\n'+henc(a.destfile_name)+'">Save to Drive</a>';
		}
		if(a.pdffile){
			var plink=a.pdffile_enc+"?t="+(new Date()).getTime();
			s1+=' &nbsp;<a href="#" onclick="proc_gview(false,this);return false" data="'+plink+'" title="View this file\n'+henc(a.pdffile_name)+'">PDF '+getsize(a.pdffile_size)+'</a>';
			s1+=' &nbsp;<a href="'+plink+'" target="_blank" title="View this file in a new window\n'+henc(a.pdffile_name)+'">New, PDF</a> &nbsp;<a href="#" onclick="proc_save(\''+escape(a.pdffileorg)+'\');return false" title="Save to Google Drive\n'+henc(a.pdffile_name)+'">Save to Drive</a>';
		}
		s1+='</div>';
		if(a.log){
			var arr=a.log.split("\n");
			for(var i = 0; i <= arr.length-1; i++){
				arr[i]=henc(arr[i]);
			}
			s1+='<div style="font-size:14px;margin-top:3px;">'+arr.join("<br>")+'</div>';
		}
		_getid("downlink").innerHTML=s1;		
	}
	function callback(a){
		if(a.error){
			alert(a.error);
		}else if(a.destfile || a.log){
			gresp.uploaded=a;
			gresp.o_opts=o_opts;
			setcontrol();
		}else{
			alert('Unknown Error.');
		}
	}
	function end(){
		u_uploading=false;
		_getid("downlink").innerHTML='';
	}

	if(gresp.uploaded && (gresp.uploaded.destfile || gresp.uploaded.log) && gresp.o_opts==o_opts){
		_getid("downlink").innerHTML='Already Converted.';
		setTimeout(function(){
			setcontrol();
		},1000);
		return;
	}
	if(u_uploading){
		alert("It's working. Please try again later. or Cancel the current job.");return;
	}

	var udata=g(false,'ipyv_iwcount');			
	if(udata.count>20){alert('You have exceeded the daily usage. Please try again later.');return;} 	
	setstorage('ipyv_iwcount', JSON.stringify(udata));

	u_uploading=true;
	_getid("downlink").innerHTML="<table><tr><td><img src='images/wait.gif' align='absmiddle'><td><div id='u_progress'>Uploading...</div><td>&nbsp; <a href='#' id='u_cancel' style='font-size:14px;display:none'>Cancel</a></table>";
	_getid("downlink2").innerHTML='';
	_getid("msg").innerHTML='';
	var uid=getstorage('ipyv_c_uniq') || '';
	if(uid.length<5){
		uid=guid();
		setstorage('ipyv_c_uniq',uid);
	}
	try{
		var xhr = new XMLHttpRequest();
		var canceled;
		var c=_getid('u_cancel');
		if(c){
			if(gresp.f) c.style.display='';
			c.onclick=function(){
				canceled=true;
				xhr.abort(); 							
				end();
				return false;
			}
		}
		var u_lastprogress=(new Date()).getTime();
		var fd = new FormData();  
		fd.append('uid', uid);
		fd.append('o_results', o_results);		
		//fd.append('o_fontsize', o_fontsize);				
		fd.append('o_mbottom', o_mbottom); 
		fd.append('o_mleft', o_mleft); 
		fd.append('o_mright', o_mright); 
		fd.append('o_mtop', o_mtop); 
		fd.append('o_pagesize', o_pagesize); 
		fd.append('o_orientation', o_orientation); 
		fd.append('o_zoom', o_zoom); 	
		if(weburl){
			fd.append('weburl', weburl);
			//var s1=get_domainfromurl(weburl); if(!s1) s1=getFileName(weburl);
			var s1=getFileName2(weburl);
			if(!s1) s1=get_domainfromurl(weburl);
			fd.append('title', s1);
		}else{
			fd.append('title', uname);
			if(gresp.f){
				fd.append('file1', gresp.f, uname);
			}else{
				fd.append('imgurl', gresp.link);
			}		
		}
		xhr.upload.onprogress = function(e) {
			if(u_lastprogress){
				var elaspetime = new Date();
				var dt=(elaspetime.getTime()-u_lastprogress);
				if(dt<300)return;
				u_lastprogress=elaspetime.getTime();
			}
			if(!e.lengthComputable)return;
			var percentComplete = (e.loaded / e.total) * 100;
			percentComplete=Math.floor(percentComplete);
			if(percentComplete>=100) percentComplete=100;
			var c=_getid('u_progress');
			if(c) c.innerHTML=percentComplete+"% Done.";
		}
		xhr.open('POST', 'upload.php', true); 		
		xhr.onload=function() {
			if(canceled)return;
			var c=_getid('u_cancel');
			if(c) c.style.display='none';

			if(this.status == 200){
				var s=trim(this.response || '');
				var a={};
				try{
					a=JSON.parse(s);
				}catch(err){
					a={};
				}
				if(a.resultfile){
					_getresults(a);
					var c=_getid('u_progress');
					if(c) c.innerHTML='100 % Done, Converting... Please Wait...';
				}else if(a.error || a.destfile || a.log){
					end();
					if(a.cached || a.busy=='ok'){
						udata.count=udata.count-1;
						setstorage('ipyv_iwcount', JSON.stringify(udata));
					}
					callback(a);
				}else{
					end();
					alert('Unknown Error.');
				}
			}else{
				end();
				alert('Error. File upload has failed.');
			}
		}
		xhr.onerror=function(e){
			if(canceled)return;
			end();
			alert("Error " + e.target.status + " occurred.");			
		}
		xhr.send(fd);	
  }catch(err){
	end();
	alert(err+'\n\nor This browser does not support. Please upgrade your browser.');
  }

var rcount=0;
var xhr2, rec2;
function _getresults(rec){
	rec2=rec;
	if(!xhr2) xhr2=new XMLHttpRequest();
	rcount++;
	if(rcount>(90/3)){
		alert('Converting Failed. Stop processing, It takes too much time to be completed.');
		end();
		return;
	}
	function go(){
		if(canceled)return;
		//console.log(rcount);
		var fd = new FormData();  
		fd.append('resultfile', rec.resultfile);
		xhr2.open('POST', 'upload.php?action=getresults', true); 		
		xhr2.onload=function(){
			if(this.status == 200){
				var a={};
				try{a=JSON.parse(this.response);}catch(err){a={};}
				if(a.error || a.destfile || a.log){
					end();
					callback(a);
					if(a.cached || a.busy=='ok'){
						udata.count=udata.count-1;
						setstorage('ipyv_iwcount', JSON.stringify(udata));
					}
					return;
				}
			}
			_getresults(rec);
		}
		xhr2.onerror=function(e){
			_getresults(rec);
		}
		xhr2.send(fd);
	}	
	var timeout=3000;
	if(rcount<2) timeout=1500;
	setTimeout(function(){go();},timeout);
}

}

function proc_open(surl, name){
	var diff=30;
	var w=parseInt(screen.availWidth-(screen.availWidth*0.1));	
	var h=parseInt(screen.availHeight-(screen.availHeight*0.1));
	if(h+(diff*2)>screen.availHeight) {
		h=screen.availHeight-(diff*2);
	}
	var winX = 0;
	var winY = diff;
	if(parseInt(navigator.appVersion) >= 4){
		winX = (screen.availWidth - w)*.5;
		//winY = (screen.availHeight - h)*.5;
	}
	var features = 'width=' + w + ',height=' + h + ',left=' + winX + ',top=' + winY +', resizable=yes, scrollbars=yes';
	var win=window.open(surl, name, features);
	if(win) win.focus();
}

function attachment_onchange(){
	if(u_uploading) return;
	var a=_getid("attachment");
	for(var i=a.options.length-1;i>=0;i--){
		if(a.options[i].selected){
			var d=cl_files[a.options[i].value];
			if(!d)return;
			gresp=d;
				var s='';
				if(d.service=="Google Drive" || d.f) s+='<a href="#" onclick="proc_gview();return false" title="View this file">View</a>&nbsp; ';
				if(d.link){
					s+='<a id="slink" href="'+(d.webContentLink || d.link)+'" target="_blank" title="Download manually and Save the file">'+henc(d.filename)+'</a>';
				}else{
					s+='<font color=black>'+henc(d.filename)+'</font>';
				}
				s+=getsize(d.size)+' - '+d.service;
				_getid("desc").innerHTML=s;
				var a=_getid('slink');
				if(a) a.download=d.filename;
			break;
		}
	}
}

function init_load(){
	proc_loadopt();
	o_results_onchange();

	var holder = document;
	holder.ondragover = function(e){ 
		_getid('divopen').className = 'hover'; 
		try{var ua=navigator.userAgent;
			if(ua && ua.indexOf("Chrome")>=0){					
				if(e.originalEvent) e = e.originalEvent;
				if(e.dataTransfer){
					var b = e.dataTransfer.effectAllowed;
					e.dataTransfer.dropEffect = ('move' === b || 'linkMove' === b) ? 'move' : 'copy';
				}
			}
		}catch(err){}
		return false; 
	};
	holder.ondragend = function(){ _getid('divopen').className = '';return false; };
	holder.ondrop = function (e){
		_getid('divopen').className = '';
		e.preventDefault();				
		handleFileSelect(e.dataTransfer.files);
		return false;
	};
	_getid('fileload1').onchange=function(e){
		if(!e || !e.target){
			alert("This browser does not support.");
			return;
		}
		handleFileSelect(e.target.files);	
	}
	_getid('fileload1').setAttribute("accept",".ipynb");

	document.optcontainer['weburl'].onkeydown=function(e){
		if(!e) e=window.event;
		var code=e.keyCode;
		var press_ctrl=typeof e.modifiers=='undefined'?e.ctrlKey:e.modifiers&Event.CONTROL_MASK;
		var press_alt=typeof e.modifiers=='undefined'?e.altKey:e.modifiers&Event.ALT_MASK;
		var press_shift=typeof e.modifiers=='undefined'?e.shiftKey:e.modifiers&Event.SHIFT_MASK;			
		var flag=false;
		if (press_alt && !press_ctrl && !press_shift){
		}else if (!press_alt && !press_ctrl && !press_shift){
			flag=true;
			if(code==13){			
				proc_upload();
			}else{
				flag=false;
			}
		}
		if(flag){
    		if (e.preventDefault) {e.preventDefault(); e.stopPropagation();}
			else {e.returnValue = false; e.cancelBubble = true;}		
		}
	}
}
init_load();
</script>

<tr><td align=center>
<div style="margin-top:5px">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1113541014872557"
     data-ad-slot="7738034505"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

</table>

<table align=center style="margin-top:10px"><tr>
<td><span id="bottomtitle">â“’ 2021, Jupyter Notebooks(ipynb) Viewer and Converter</span>
</table>

<br>

<style>
.gd_div{background-color:#FFFFE1;position:absolute;overflow:hidden;-webkit-box-shadow: 0 0 25px #999;-moz-box-shadow: 0 0 25px #999;box-shadow: 0 0 25px #999;}
</style>
<div id="layer_message" class="gd_div" style="z-index:10001;display:none;"></div>
<div id="gd_window" class="gd_div" style="z-index:10000001;display:none;"></div>
<div id="gd_btn_login" class="gd_div" style="z-index:10000000;display:none;">
<table>
<tr><td align=center><button onclick="gd_login_manual()" style="font-size:20px"><img src="images/gdrive/product20.png" align="absmiddle"> Login & Authorize</button> <button onclick="gd_login_close()" style="font-size:20px">Close</button>
<tr><td>To use this app, Please login to the Google Drive and authorize this app or website.
<br>(Note: If your browser block or disable the third-party cookies, this login does not work correctly.)
</table>
</div>
<script>
var CLIENT_ID = '441626076259-3pboblb27v5lmm52986t4ro462h0o0k3.apps.googleusercontent.com';
var SCOPES = [
	'https://www.googleapis.com/auth/drive.install',
	'https://www.googleapis.com/auth/drive.file'
];
var gd_developerKey='AIzaSyDBClnZ4VMnwwYzSuCWJN1eRusk44oHNuA';
var gd_mimetype="";//application/x-ipynb+json
var gd_export_extension=[['application/x-ipynb+json','ipynb']];
var gd_state='';

var gd_picker,gd_loaded,gd_pickerloaded,gd_lastprogress,gd_issupported,gd_isdownloading,gd_load_timer,gd_bloburl,gd_state2;
var gd_loginexp=0;
var gd_callback;
var ismsie=false;
if(navigator.appName!="Netscape"){
	if(navigator.userAgent.indexOf("MSIE")>=0) ismsie=true;
}
if(navigator.userAgent.match(/Trident\//)) ismsie=true;

function gd_btn_login2(e,callback){
	var sl=getScrollLeft();
	var st=getScrollTop();
	var w=getWindowWidth();
	var h=getWindowHeight();

	function go(a){
		if(a && a.style.display==''){
			var x=sl+((w-a.clientWidth) / 2);
			var y=st+((h-a.clientHeight) / 2);
			a.style["border"]="1px solid #000000";
			a.style["padding"]="10px";
			a.style.left=x+"px";
			a.style.top=y+"px";
		}
	}
	function go2(){
		var a=_getid("gviewer");	
		if(a.style.display!='')return;
		//if(!gresp)return;
		var dy=40;
		var dy2=15;
		var dr=0.07;		
		if(false && gresp.videoMediaMetadata && gresp.videoMediaMetadata.width && gresp.videoMediaMetadata.height){
			var odw=gresp.videoMediaMetadata.width;var odh=gresp.videoMediaMetadata.height;
			var dw=odw;var dh=odh;
			var mw=w-(parseInt(w*dr)*2);
			var mh=h-dy-dy2;
			var dt=0;
			if(dw>mw){
				dw=mw; dh=dw*odh/odw; dt=12;
			}
			if(dh>mh){
				dh=mh; dw=dh*odw/odh; dt=12;
			}
			a.style.left=(sl+((w-dw)/2))+'px';
			a.style.width=dw+'px';
			var y=(st+((h-dh)/2)+dt);
			a.style.top=y+'px';				
			a.style.height=dh+'px';			
		}else{
			a.style.left=(sl+parseInt(w*dr))+'px';
			a.style.width=(w-(parseInt(w*dr)*2))+'px';
			//a.style.left=(sl+((w-820)/2))+'px';
			//a.style.width='820px';
			var y=st+dy;
			a.style.top=y+'px';			
			a.style.height=(h-dy-dy2)+'px';			
		}
		var b=_getid("btn_gvclose");
		b.style.display='';
		var x=sl+((w-b.offsetWidth) / 2);		
		y=y-b.offsetHeight;
		b.style.left=x+'px';
		b.style.top=y+'px';
	}

	go(_getid("gd_btn_login"));
	go(_getid("gd_window"));	
	setTimeout(function(){
		go(_getid("gd_btn_login"));
		go(_getid("gd_window"));	
		if(callback)callback();
	},10);
	go2();
}
function gd_btn_login(isshow){
	var a=_getid("gd_btn_login");
	if(isshow){
		a.style.display='';
		gd_btn_login2();
	}else{
		a.style.display='none';
	}
}
function gd_login_close(){
	gd_btn_login(false);
	gd_state='';
}
function gd_login_manual(){
	var p={'client_id': CLIENT_ID, 'scope': SCOPES.join(' '), 'immediate': false};
	if(gd_userId){p['login_hint']=gd_userId;p['authuser']=-1;}
	gapi.auth.authorize(p, function (authResult){ 
		if (authResult && !authResult.error){
			gd_loginexp=(new Date()).getTime()+parseInt(authResult.expires_in*0.7*1000);
			gd_btn_login(false);gd_info();
			show_message("Login ok!!");
			if(gd_callback) gd_callback(true);
			else gd_open_state(true);
		}else{
			gd_btn_login(true);
			show_message("Login failed!!");
		}
	});
}
function gd_login(callback,react){
	if(gd_loginexp==0 || gd_loginexp<(new Date()).getTime()){
	}else{
		callback(true);
		return;
	}
	var p={'client_id': CLIENT_ID, 'scope': SCOPES.join(' '), 'immediate': true};
	if(gd_userId){p['login_hint']=gd_userId;p['authuser']=-1;}
	gapi.auth.authorize(p, function (authResult){
		if (authResult && !authResult.error){
			gd_loginexp=(new Date()).getTime()+parseInt(authResult.expires_in*0.7*1000);
			gd_btn_login(false);gd_info();
			callback(true);
		}else{
			show_message("Login failed!!");
			gd_btn_login(true);
			callback(false);
			if(react) gd_callback=callback;
			else gd_callback=null;
		}
	});
}
function gd_checklogin(callback){
	gd_login(function(result){
		if(result)callback();
	},true);
}

function gd_loadpicker() {		
	gapi.load('picker',{'callback': function(){
			gd_pickerloaded=true;
		}
	});	
}
function gd_createpicker() {
	var access_token=gapi.auth.getToken().access_token;
	if(!access_token){
		alert('Error!! No access token.');
		return;
	}
	if(!gd_picker){
	  var view2 = new google.picker.DocsView(google.picker.ViewId.DOCS);
	  if(gd_mimetype) view2.setMimeTypes(gd_mimetype);
	  view2.setMode(google.picker.DocsViewMode.LIST);

		var view4 = new google.picker.DocsView();
		view4.setIncludeFolders(true);
		view4.setSelectFolderEnabled(false);
		view4.setParent("root");
		view4.setMimeTypes(gd_mimetype);
		view4.setMode(google.picker.DocsViewMode.LIST);
		var view5 = new google.picker.View(google.picker.ViewId.RECENTLY_PICKED);

      gd_picker = new google.picker.PickerBuilder()
          //.enableFeature(google.picker.Feature.NAV_HIDDEN)
          .enableFeature(google.picker.Feature.MULTISELECT_ENABLED)
		  .setLocale("en") 
		  .setAppId(CLIENT_ID.split("-")[0])
		  .setTitle('Select the files')// and folders
          .setOAuthToken(access_token)
          .addView(view2)
		  .addView(view4)
		  .addView(view5)
          .addView(new google.picker.DocsUploadView())
          .setDeveloperKey(gd_developerKey)
          .setCallback(gd_pickercallback)
          .build();
	}
	gd_picker.setVisible(true);
}
function gd_pickercallback(data) {
	if (data.action == google.picker.Action.PICKED) {
		if(data.docs && data.docs.length>0 && data.docs[0].id){
			gd_loadfiles(data.docs);
		}
	}
}

function gd_checkwork(){
	if(gd_isdownloading){
		alert("It's working. Please try again later. or Cancel the current task.");
		return true;
	}
}

function gd_loadfiles(docs){
	if(gd_checkwork())return;

	function end(){
		gd_isdownloading=false;
		clearTimeout(messagetimer);
		hide_message();
		_getid("downlink").innerHTML='';
	}	

	var canceled=false;
	_getid("downlink").innerHTML="<table><tr><td><img src='images/wait.gif' align='absmiddle'><td><a href='#' id='gd_cancel'>Cancel</a>&nbsp;<td><div id='gd_progress'>Getting file information...</div></table>";	
	_getid('gd_cancel').onclick=function(){
		canceled=true;
		return false;
	}
	gd_isdownloading=true;
	if(!docs){
		end();return;
	}

	var files=[];
	for(var i = 0; i <= docs.length-1; i++){
		if(!docs[i].id)continue;
		var d={};
		d.id=docs[i].id;
		d.name=docs[i].name;
		d.done=false;
		files.push(d);
	}
	
	function complete(){
		var accessToken = gapi.auth.getToken().access_token;
		var a,d;
		cl_files=[];
		for(var i = 0; i <= files.length-1; i++){
			d=files[i];
			if(!d.resp || !d.resp.title || d.resp.mimeType=='application/vnd.google-apps.folder')continue;
			a={};
			a.service='Google Drive';
			a.filename=d.resp.title;
			if(d.resp.downloadUrl){
				a.link=d.resp.downloadUrl+'&access_token='+encodeURIComponent(accessToken);
				a.link2=d.resp.downloadUrl;
				a.link3='https://www.googleapis.com/drive/v2/files/'+d.resp.id+'?alt=media';
				a.webContentLink=d.resp.webContentLink;
				a.size=d.resp.fileSize;
			}else if(d.resp.exportLinks){
					for (x in d.resp.exportLinks){
						for(var j = 0; j < gd_export_extension.length; j++){    
							if(x.toLowerCase().indexOf(gd_export_extension[j][0])>=0){
								a.link=d.resp.exportLinks[x]+'&access_token='+encodeURIComponent(accessToken);
								a.link2=d.resp.exportLinks[x];
								a.filename=d.resp.title+"."+gd_export_extension[j][1];
								break;
							}						
						}					
						if(a.link)break;
					}
			}
			a.id=d.resp.id;
			a.resp=d.resp;
			cl_files.push(a);
		}
	    cl_display();
	}

	var joblist=[];
	var jobtimer;
	function getentryidx(){
		for(var i = 0; i <= files.length-1; i++){
			if(!files[i].done){
				files[i].done=true;
				return i;
			}
		}
		return null;
	}
	function checkjoblist(){
		if(joblist.length==0)return;
		for(var i = 0; i <= joblist.length-1; i++){
			if(!joblist[i].complete)return;
		}
		clearInterval(jobtimer);
		end();
		complete();
	}
	
	var c_scansub=false;
	function get(jobidx){
		function _call(){
			var a=joblist[jobidx];
			a.func(jobidx)
		}
		var idx=getentryidx();
		if(idx==null || canceled){
			joblist[jobidx].complete=true;
			return;
		}
		if(files[idx].resp){			
			_call();
			return;
		}

		function _progress(s){
			var a=_getid("gd_progress");
			if(a) a.innerHTML='('+(idx+1)+'/'+files.length+') '+henc(s);
		}
		var folderlist;
		function getfolder(folderidx){
			if(folderidx>folderlist.length-1 || canceled){
				_call();
				return;
			}
			_progress('Getting files in the folder... '+folderlist[folderidx].name);
			retrieveAllFiles("'"+folderlist[folderidx].id+"' in parents and trashed=false", function(results){
				var parent=folderlist[folderidx].parent || '';
				if(parent) parent+='/';
				parent+=folderlist[folderidx].name || '';
				
				for(var i = 0; i <= results.length-1; i++){
					var d={};
					d.id=results[i].id;
					d.name=results[i].title;
					d.resp=results[i];
					d.parent=parent;
					d.done=true;
					files.push(d);
					if(c_scansub && d.resp.mimeType=='application/vnd.google-apps.folder'){
						folderlist.push(d);
					}
				}		
				folderidx++;			
				getfolder(folderidx);
			});		
		}

		var fileId=files[idx].id;
		_progress('Getting file info...');

			var request = gapi.client.drive.files.get({
				'fileId': fileId
			});
			request.execute(function(resp){				
				if(resp.error){
					var s='Error. ';
					if(files[idx].name) s+=files[idx].name+'  ';
					if(resp.error.message) s+=resp.error.message+' ';
					if(resp.error.code==401) s+='Login or Authorize Error.';					
					proc_log(s,'error');
				}
				files[idx].resp=resp;
				if(!files[idx].name) files[idx].name=resp.title;

				/*if(files[idx].resp.mimeType=='application/vnd.google-apps.folder'){
					folderlist=[];
					folderlist.push(files[idx]);
					getfolder(0);
				}else{*/
					_call();
				//}
			});
	}

	if(files.length==0){
		end();return;
	}
	gapi.client.load('drive', 'v2', function(){
		jobtimer=setInterval(checkjoblist,200);
		for(var i = 0; i < 2; i++){
			var a={};
			a.func=get;
			a.complete=false;
			joblist.push(a);
			a.func(i);
		}
	});
}
function proc_log(s,name,s2){
	s='<font class="'+(name || '')+'">'+henc(s)+'</font>';
	if(s2) s=s+' '+s2;
	_getid('downlink2').innerHTML=s;
}
function retrieveAllFiles(query,callback) {
  var retrievePageOfFiles = function(request, result) {
    request.execute(function(resp) {
      result = result.concat(resp.items);
      var nextPageToken = resp.nextPageToken;
      if (nextPageToken) {
        request = gapi.client.drive.files.list({
          'q': query, 'pageToken': nextPageToken,
        });
        retrievePageOfFiles(request, result);
      } else {
        callback(result);
      }
    });
  }
  var initialRequest = gapi.client.drive.files.list({
		'q': query		
       });
  retrievePageOfFiles(initialRequest, []);
}

function gd_open_picker(){
	if(gd_checkwork())return;
	if(!gd_issupported){
		alert("This browser does not support.");
		return;
	}
	if(!gd_loaded || !gd_pickerloaded){
		if(!gd_load_timer) gd_loadscript(gd_open_picker);
		else alert('Not loaded library. Please try again in a few minutes.');
		return;
	}
	gd_checklogin(function(){
		gd_createpicker();
	});
}
function gd_open_state(force){
	var s=gd_state;
	if(s){
		if(!gd_issupported){
			gd_state='';
			alert("This browser does not support.");
			return;
		}
		s=decodeURIComponent(s);
		try{
			var a=JSON.parse(s);
			var ids=[];
			function find(b){
				if(!b)return;
				for(var i=0; i <= b.length-1; i++){
					if(b[i]){
						var cc={};
						cc.id=b[i];
						ids.push(cc);
					}
				}
			}
			find(a.ids);
			find(a.exportIds);
			if(ids.length>0){
				gd_login(function(result){
					if(gd_open2 && !force)return;
					gd_open2=true;
					if(!result)return;				
					//_getid('gd_btn_reopen').style.display='';
					gd_state='';
					gd_loadfiles(ids,true);
				});				
			}
		}catch(err){
		}
	}
}
function gd_clientload(){
	gd_loaded=true;
	if (window.addEventListener){
		window.addEventListener("resize", gd_btn_login2, false);
	}else if (window.attachEvent){
		window.attachEvent("onresize", gd_btn_login2);
	}
	gd_open_state();
}
var gd_open2;
function gd_open_state2(){
	setTimeout(function(){
		if(!gd_open2)gd_open_state();
	}, 1000);
}

function gd_loadscript(callback){
	function inject(s){
		var o = document.createElement('scri' + 'pt');
		o.setAttribute('src', s);
		o.setAttribute('type', 'text/javascript');
		document.body.appendChild(o);
	}
	if(gd_load_timer)return;
	if(gd_loaded && gd_pickerloaded)return;
	gd_load_timer=setInterval(function(){
		if(gd_loaded && gd_pickerloaded){
			clearInterval(gd_load_timer);
			if(callback) callback();
		}
	},100);
	inject('https://apis.google.com/js/client.js?onload=gd_clientload');
	inject('https://apis.google.com/js/api.js?onload=gd_loadpicker');	
}

var gd_userId,gd_email;
function gd_weburl(){
	var s;
	if(gd_email) s='https://drive.google.com/?authuser='+gd_email;
	else s='https://drive.google.com/';
	return s;
}
function gd_info(){
	if(gd_email)return;
	gapi.client.load('drive', 'v2', function(){
		var request = gapi.client.drive.about.get();
		request.execute(function(resp) {
			if(resp && resp.user){
				if(gd_email)return;
				gd_email=resp.user.emailAddress;
				if(gd_email){
					var a=_getid('btn_open');
					var b=_getid('gd_btn_reopen');
					if(a)a.title=a.title+' ('+gd_email+')';
					if(b)b.title=b.title+' ('+gd_email+')';
				}				
			}
		});
	});
}
function gd_dblclick(){
	function dblclick(){
		try{
			if(gd_picker)gd_picker.setVisible(false);
		}catch(err){}
	}
	function keydown(e){
		if(!e)e=window.event;
		if(e && e.keyCode==27){
			dblclick();
			proc_rssclose();
		}
	}
	if(window.addEventListener){
		document.addEventListener("dblclick", dblclick, false);
		document.addEventListener("keydown", keydown, false);
	}else if(window.attachEvent){
		document.attachEvent("ondblclick", dblclick);
		document.attachEvent("onkeydown", keydown);
	}
	document.documentElement.onmouseup=function(e){
		if(!e) e=event;
		if(e.button!=0 && e.button!=1)return;
		var w=getWindowWidth()-27;
		var h=getWindowHeight()-27;
		if(e.clientX>w || e.clientY>h) return;
    	var b2;
		if(e.target) b2 = e.target;
		else if(e.srcElement) b2 = e.srcElement;
		if(b2.tagName=='A' || b2.tagName=='SPAN')return;
    	while (b2) {
			if(b2.id=="rssviewer" || b2.id=="imgrss"){
				return;
			}
    		if (b2==document.body) break;
			if (b2.parentElement) b2=b2.parentElement;
			else b2=b2.parentNode;
    	}
		proc_rssclose();
	}
}
function gd_init(){
	gd_dblclick();
	gd_state2=gd_state;
	if(!window.XMLHttpRequest || !window.URL){
	}else{
		gd_issupported=true;
		if(gd_state){
			try{
				var a=JSON.parse(gd_state);
				gd_userId=a.userId;
				if(a.ids || a.exportIds){
					_getid("downlink").innerHTML="<table><tr><td><div id='gd_progress'>Ready...</div></table>";
				}
			}catch(err){}			
			if(window.addEventListener) window.addEventListener("load", gd_open_state2, false);
			else if (window.attachEvent) window.attachEvent("onload", gd_open_state2);
		}
		gd_loadscript();
	}
}
gd_init();
</script>


<script>
var gresp, g_lastbloburl2;
function _getfrmdoc(ifrm){
	return (ifrm.contentWindow) ? ifrm.contentWindow : (ifrm.contentDocument.document) ? ifrm.contentDocument.document : ifrm.contentDocument;
}
function proc_gview(id, obj){
	var s;
	var a=_getid("gviewer");	
	function _view(fname){
		if(!fname) fname="";
		var ext=getfileext(fname.split("?")[0]);
		if(ext=='pdf'){
			if(ismsie || isedge){
				a.style.display='';
				var ifrm2 = _getfrmdoc(a);
				var c;
				try{c=ifrm2.proc_load;}catch(err){c='';}
				if(!c){
					a.onload=function(){
						if(ifrm2.proc_load) ifrm2.proc_load(s,resp.filename,true);
					}
					ifrm2.location.replace('../pdfviewer/web/');
				}else{
					ifrm2.proc_load(s,resp.filename,true);
				}
				document.body.style.overflow='hidden';
				gd_btn_login2();	
				return true;
			}
		}else if(ext=='htm' || ext=='html' || ext=='ipynb'){
		}else{
			alert('Can not view this file type.');
			return true;
		}
	}
	function go(){
		a.style.display='';
		var ifrm2 = _getfrmdoc(a);
		ifrm2.location.replace(s);
		document.body.style.overflow='hidden';
		gd_btn_login2();	
	}

	var resp=gresp;
	if(obj){
		s=obj.getAttribute("data");
		if(_view(s)) return;
	}else if(id){
		s='https://drive.google.com/file/d/'+id+'/preview';
	}else if(resp && resp.id){
		s='https://drive.google.com/file/d/'+resp.id+'/preview';
		if(resp.alternateLink){
			var p1=resp.alternateLink.lastIndexOf("/");
			if(p1>=0) s=resp.alternateLink.substr(0,p1)+'/preview';
		}
	}else if(resp && resp.f){
		if(!window.URL){
			alert('Not supported on this browser');
			return;
		}
		if(g_lastbloburl2) window.URL.revokeObjectURL(g_lastbloburl2);
		g_lastbloburl2=window.URL.createObjectURL(resp.f);
		s=g_lastbloburl2;

		var ext=getfileext(resp.filename);
		if(ext=='ipynb'){
			var reader=new FileReader();
			reader.onload = function(e){
				var blob = new Blob([e.target.result], {encoding:"UTF-8",type:"text/plain;charset=UTF-8"});
				if(g_lastbloburl2) window.URL.revokeObjectURL(g_lastbloburl2);
				g_lastbloburl2=window.URL.createObjectURL(blob);
				s=g_lastbloburl2;
				go();
			}
			reader.onerror=function(){
				go();
			}
			if(reader.readAsText){
				reader.readAsText(resp.f, 'UTF-8');
				return;
			}
		}
		if(_view(resp.filename)) return;
	}else{
		return;
	}
	go();
}
function proc_rssclose(){
	var a=_getid("gviewer");	
	if(a && a.style.display==''){
		a.style.display="none";	
		_getid("btn_gvclose").style.display="none";	
		document.body.style.overflow='';
		try{
			var ifrm2 = _getfrmdoc(a);
			if(ifrm2) ifrm2.location.replace('about:blank');
		}catch(err){}
	}
}

function proc_save(outputname_org){
	outputname_org=unescape(outputname_org || '');
	if(!outputname_org){
		alert('Can not find a merged file.');return;
	}
	if(gd_isdownloading){
		alert("It's working... Please try again later.");return;
	}
	var arr=outputname_org.split('/');
	var filename=arr[arr.length-1];

	var accessToken, xhr;
	_getid("msg").innerHTML="<table><tr><td><div id='gd_progress2'></div></table>";
	
	function end(){
		gd_isdownloading=false;
		//var s='Completed.';
		//proc_log(s,'welcome');		
	}
	function _progress(name,s,state,s2,nolog){
		var s=s+' '+filename;
		//if(!nolog) proc_log(s,state,s2);
		var a=_getid("gd_progress2");
		if(a) a.innerHTML=henc(s);
	}	
    function go(){
		gd_isdownloading=true;
	  try{
		_progress('log1','Saving...');	
		var fd = new FormData();  
		fd.append('outputname_org', outputname_org);
		fd.append('authtoken', accessToken);
		fd.append('savefolderid', '');
		var ext=getfileext(outputname_org);
		if(ext=='zip') fd.append('mimeType', 'application/zip');
		else if(ext=='htm' || ext=='html') fd.append('mimeType', 'text/html');
		else if(ext=='pdf') fd.append('mimeType', 'application/pdf');

		xhr=new XMLHttpRequest();
		xhr.open('POST', 'upload.php?action=savetodrive', true); 
		xhr.onload=function() {
			if(this.status==200){
				var a={};
				try{a=JSON.parse(this.response);}catch(err){a={};}
				//console.log(a);
				if(a.error){
					_progress('log1',a.error,'error');
				}else if(a.drive){
					var result={};
				    try{result=JSON.parse(a.drive);}catch(err){result={};} 
					if(result.error){
						var s='Error. ';
						if(result.error.message) s+=result.error.message+' ';
						if(result.error.code==401){
							s+='Login or Authorize Error.';
						}
						_progress('log1',s,'error');
					}else if(result.id){
						var s='Saved to Drive.';
						var s2='';//henc(result.title);
						var link=result.alternateLink || result.webContentLink;
						s2+=' &nbsp;<a href="#" onclick="proc_gview(\''+result.id+'\');return false" title="View this file">View</a>';
						if(link) s2+=' &nbsp;<a href="'+link+'" target="_blank" title="View this file in new window">New</a>';
						if(result.parents && result.parents[0] && result.parents[0].id){
							s2+=' &nbsp;<a href="'+gd_weburl()+'#folders/'+result.parents[0].id+'" target="_blank" title="Show folder">Folder</a>';
						}
						if(result.downloadUrl) s2+=' &nbsp;<a href="'+(result.webContentLink || (result.downloadUrl+'&access_token='+encodeURIComponent(accessToken)))+'" target="_blank" download="">Download</a>';
						s2+=' &nbsp;<a href="#" onclick="proc_delete(\''+result.id+'\',this);return false" data="'+escape(result.title || '')+'" title="Delete this file">Delete</a>';
						//proc_log(s,'uploaded',s2);
						_getid("msg").innerHTML=s+' '+s2;
					}else{
						_progress('log1','Unknown Error.','error');
					}
				}else{
					_progress('log1','Unknown Error.','error');
				}
			}else{
				_progress('log1',"Error (status) " + this.status + "("+this.statusText+") occurred while uploading the file.",'error');
			}
			end();
		}
		xhr.onerror=function(e){
			_progress('log1',"Error " + e.target.status + " occurred while uploading the file.",'error');
			end();
		}
		xhr.send(fd);	
	  }catch(err){
		_progress('log1',err+' or This browser does not support. Please upgrade your browser.','error');
		end();
	  }
	}

	gd_checklogin(function(){
		accessToken = gapi.auth.getToken().access_token;
		if(!accessToken){
			_progress('log1','Error!! No access token.','error');
			end();return;
		}
		go();
	});
}
function proc_delete(fileid,f){
	if(!fileid) return;
	if(gd_isdownloading){
		alert("It's working... Please try again later.");return;
		return;
	}	
	//gd_isdownloading=true;
	var title=unescape(f.getAttribute("data") || '');
	function _log(s){
		var a=_getid('gd_progress2');
		if(!a){
			_getid("downlink2").innerHTML="<table><tr><td><div id='gd_progress2'></div></table>";
			a=_getid('gd_progress2');
		}
		if(a) a.innerHTML=s;
	}
	_log('Deleting...');
	var request = gapi.client.drive.files['delete']({
		'fileId': fileid
	});
	request.execute(function(resp){
		//gd_isdownloading=false;
		var s;
		if(resp.result && !resp.message){
			s='<font style="color:green">File deleted successfully. '+henc(title)+'</font>';
			_log(s);
		}else{
			s='<font style="color:red">Delete failed. <b>'+resp.message+'</b> '+henc(title)+'</font>';
			_log(s,'error');
		}		
	});
}
</script>
<style>.shadow{border:0px solid silver;-webkit-box-shadow: 0 0 10px #999;	-moz-box-shadow: 0 0 10px #999; box-shadow: 0 0 10px #999;}</style>
<button type="button" id="btn_gvclose" style="z-index:10000010;position:absolute;font-size:20px;padding:4px 25px;display:none;white-space:nowrap"><img src="images/cancel.png" width=14 align="absmiddle"> Close</button>
<iframe id="gviewer" src="" style="z-index:10000011;position:absolute;display:none;background-color:white" class="shadow" frameborder=0 allowfullscreen="true"></iframe>
<script src="https://storage.googleapis.com/app0126/js/bottom.js" async tos="../tos.php?app=Jupyter%20Notebooks%28ipynb%29%20Viewer%20and%20Converter" sitetitle="Jupyter Notebooks(ipynb) Viewer and Converter"></script>
<script>
function gd_findscope(s){
	function trim(str){return (str || '').replace(/^\s*|\s*$/g,"");}
	var s1;
	try{
		if(!s) return false;
		s=' '+s.toLowerCase()+' ';
		for(var i = 0; i < SCOPES.length; i++){    
			if(!SCOPES[i])continue;
			s1=trim(SCOPES[i].split('/').pop().toLowerCase());
			//if(s1=='drive.appfolder') s1='drive.appdata';
			if(!/^(drive\.install|drive\.file|drive)$/.test(s1)) continue;
			if(s.indexOf(s1+' ')<0) return false;
		}
	}catch(err){}
	return true;
}
function init_fix_scope(){	
	var a=window.gd_login_manual;
	var b=window.gd_login;
	var ss='if (authResult && !authResult.error';
	if(a && (a+'').indexOf(ss)>=0 && (a+'').indexOf('gd_findscope(')<0){
		a=(a+'').replace(ss,'if (authResult && !authResult.error && gd_findscope(authResult.scope)');
		window.eval(a);
	}
	if(b && (b+'').indexOf(ss)>=0 && (b+'').indexOf('gd_findscope(')<0){
		b=(b+'').replace(ss,'if (authResult && !authResult.error && gd_findscope(authResult.scope)');
		window.eval(b);
	}
}
init_fix_scope();
</script>
</body>
</html>